<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Sekolah Minggu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}.container{max-width:1200px;margin:0 auto;background:white;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden}.page{padding:30px;display:none}.page h2{color:#333;margin-bottom:20px;text-align:center}#loginPage{display:block;text-align:center}#loginPage h2{margin-bottom:30px;color:#667eea}.form-group{margin-bottom:20px;text-align:left}.form-group label{display:block;margin-bottom:8px;color:#555;font-weight:600}.form-group input{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px;transition:border-color .3s}.form-group input:focus{outline:none;border-color:#667eea}button{width:100%;padding:12px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s,box-shadow .2s}button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.4)}.dashboard-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:20px;border-radius:10px;text-align:center}.stat-card h3{font-size:36px;margin:10px 0}.stat-card p{opacity:.9}.dashboard-menu{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:30px}.menu-btn{padding:20px;background:white;color:#667eea;border:2px solid #667eea;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s;width:auto}.menu-btn:hover{background:#667eea;color:white;transform:translateY(-3px);box-shadow:0 5px 15px rgba(102,126,234,.3)}table{width:100%;border-collapse:collapse;margin-top:20px;background:white;border-radius:10px;overflow:hidden}th,td{padding:12px;text-align:left;border-bottom:1px solid #ddd}th{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;font-weight:600}tr:hover{background:#f5f5f5}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:20px}.form-group-inline{margin-bottom:15px;text-align:left}.form-group-inline label{display:block;margin-bottom:8px;color:#555;font-weight:600}.form-group-inline input,.form-group-inline select,.form-group-inline textarea{width:100%;padding:10px;border:2px solid #ddd;border-radius:8px;font-size:14px}.form-group-inline textarea{resize:vertical;min-height:80px}.radio-group{display:flex;gap:15px;margin-top:8px}.radio-group label{display:flex;align-items:center;gap:5px;cursor:pointer;font-weight:normal}.radio-group input[type=radio]{width:auto}.action-buttons{display:flex;gap:10px;margin-top:20px;justify-content:center}.btn-secondary{background:#6c757d;width:auto;padding:10px 20px}.btn-secondary:hover{background:#5a6268}.btn-success{background:#28a745;width:auto;padding:10px 20px}.btn-success:hover{background:#218838}.btn-danger{background:#dc3545;width:auto;padding:10px 20px}.btn-danger:hover{background:#c82333}.btn-info{background:#17a2b8;width:auto;padding:10px 20px}.btn-info:hover{background:#138496}.btn-warning{background:#ffc107;color:#333;width:auto;padding:10px 20px}.btn-warning:hover{background:#e0a800}.viewport{position:relative;overflow:hidden;background:#000;border:3px solid #4CAF50;border-radius:10px;margin:20px auto;max-width:640px;width:100%}.viewport video{display:block;width:100%;height:auto}.viewport canvas{position:absolute;top:0;left:0;width:100%;height:100%}.viewport::after{content:'';position:absolute;top:50%;left:0;width:100%;height:3px;background:rgba(76,175,80,.8);box-shadow:0 0 10px rgba(76,175,80,.8);animation:scanline 2s infinite linear;z-index:10}@keyframes scanline{0%{top:0}100%{top:100%}}#scanStatus{text-align:center;margin:15px;padding:10px;background:#f0f0f0;border-radius:5px;transition:all .3s}#scanResult{margin:20px;padding:20px;background:#e8f5e9;border-radius:10px;border-left:5px solid #4CAF50}#resultDetails{margin-top:15px;line-height:1.8}#resultDetails p{margin:8px 0}#resultDetails strong{color:#333}#qrcodeContainer{text-align:center;margin-top:10px;padding:15px;background:#f9f9f9;border-radius:8px;border:2px dashed #667eea}.scan-controls{display:flex;gap:10px;justify-content:center;margin:20px 0}#startScan,#stopScan{width:auto;padding:12px 24px;font-size:16px}#stopScan{background:#f44336}#stopScan:hover{background:#d32f2f}.manual-input-group{margin:20px;padding:15px;background:#e3f2fd;border-radius:5px;text-align:center}#manualBarcode{padding:10px;width:60%;border:2px solid #2196F3;border-radius:5px;font-size:14px}.manual-search-btn{padding:10px 15px;background:#2196F3;color:white;border:none;border-radius:5px;cursor:pointer;font-size:14px;width:auto;margin-left:10px}.manual-search-btn:hover{background:#0d8aee}.upload-section{background:#e3f2fd;padding:20px;border-radius:10px;margin:20px 0;text-align:center}.upload-area{border:3px dashed #2196F3;border-radius:10px;padding:40px 20px;margin:20px 0;background:white;cursor:pointer;transition:all .3s}.upload-area:hover{background:#f5f5f5;border-color:#667eea}#fileInput{display:none}.file-info{margin-top:15px;padding:10px;background:white;border-radius:5px;text-align:left}.preview-table{width:100%;margin-top:20px;border-collapse:collapse}.preview-table th,.preview-table td{padding:8px;border:1px solid #ddd;text-align:left}.preview-table th{background:#667eea;color:white}.preview-table tr:nth-child(even){background:#f9f9f9}.import-summary{background:#e8f5e9;padding:15px;border-radius:5px;margin:15px 0;text-align:left}.import-summary strong{color:#2e7d32}@media (max-width:768px){.container{padding:10px}.page{padding:20px}.dashboard-stats,.dashboard-menu,.form-grid{grid-template-columns:1fr}#manualBarcode{width:100%;margin-bottom:10px}.manual-search-btn{width:100%;margin-left:0}.action-buttons{flex-direction:column}.action-buttons button{width:100%!important}}
    </style>
</head>
<body>
    <div class="container">
        <div id="loginPage" class="page">
            <h2>üîê Login Inventory</h2>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button onclick="login()">Masuk</button>
        </div>
        
        <div id="dashboardPage" class="page">
            <h2>üè† Dashboard Inventaris</h2>
            <p style="text-align:center;margin-bottom:20px;font-size:18px">Selamat datang, <span id="userName">Admin</span>!</p>
            <div class="dashboard-stats">
                <div class="stat-card"><p>Total Barang</p><h3 id="totalItems">0</h3></div>
                <div class="stat-card"><p>Barang Baik</p><h3 id="goodItems">0</h3></div>
                <div class="stat-card"><p>Perlu Perbaikan</p><h3 id="repairItems">0</h3></div>
                <div class="stat-card"><p>Barang Rusak</p><h3 id="brokenItems">0</h3></div>
            </div>
            <div class="upload-section">
                <h3>üì§ Upload Data Inventory (CSV)</h3>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <p><strong>Klik di sini</strong> atau <strong>drag & drop</strong> file CSV Anda</p>
                    <p style="font-size:14px;color:#666;margin-top:10px">Format file: .csv</p>
                    <input type="file" id="fileInput" accept=".csv" onchange="handleFileSelect(event)">
                </div>
                <div id="fileInfo" style="display:none" class="file-info"></div>
                <div id="previewContainer" style="display:none;margin-top:20px">
                    <h4>üìã Preview Data:</h4>
                    <div style="max-height:300px;overflow-y:auto;margin-top:10px">
                        <table class="preview-table" id="previewTable">
                            <thead>
                                <tr>
                                    <th>NO</th><th>NAMA</th><th>TYPE</th><th>LAMA</th><th>BARU</th><th>QTY</th><th>STATUS</th><th>CATATAN</th>
                                </tr>
                            </thead>
                            <tbody id="previewTableBody"></tbody>
                        </table>
                    </div>
                    <div id="importSummary" class="import-summary" style="display:none"></div>
                    <div class="action-buttons" style="margin-top:15px">
                        <button class="btn-success" onclick="importData()" style="flex:1">‚úÖ Import Data</button>
                        <button class="btn-secondary" onclick="cancelImport()" style="flex:1">‚ùå Batal</button>
                    </div>
                </div>
            </div>
            <div class="dashboard-menu">
                <button class="menu-btn" onclick="showPage('inventoryPage')">üìã Daftar Inventaris</button>
                <button class="menu-btn" onclick="showPage('addPage')">‚ûï Tambah Barang</button>
                <button class="menu-btn" onclick="showPage('scanPage')">üì∑ Scan Barcode</button>
                <button class="menu-btn" onclick="showPage('reportPage')">üìä Laporan</button>
                <button class="menu-btn" onclick="logout()">üö™ Logout</button>
            </div>
        </div>
        
        <div id="inventoryPage" class="page">
            <h2>üìã Daftar Inventaris</h2>
            <div class="action-buttons">
                <button class="menu-btn" onclick="showPage('addPage')" style="flex:1">‚ûï Tambah Barang</button>
                <button class="menu-btn" onclick="showPage('scanPage')" style="flex:1">üì∑ Scan Barcode</button>
                <button class="menu-btn" onclick="document.getElementById('inventoryFileInput').click()" style="flex:1;background:#ffc107;color:#333">üì§ Upload CSV</button>
                <button class="menu-btn" onclick="showPage('dashboardPage')" style="flex:1">‚¨ÖÔ∏è Kembali</button>
                <input type="file" id="inventoryFileInput" accept=".csv" onchange="handleFileSelect(event)" style="display:none">
            </div>
            <table>
                <thead>
                    <tr>
                        <th>No</th><th>Nama</th><th>Type</th><th>Qty Lama</th><th>Qty Baru</th><th>Qty Total</th><th>Status</th><th>Barcode</th><th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody"></tbody>
            </table>
        </div>
        
        <div id="addPage" class="page">
            <h2>‚ûï Tambah Barang</h2>
            <div class="form-grid">
                <div class="form-group-inline">
                    <label for="itemName">Nama Barang *</label>
                    <input type="text" id="itemName" placeholder="Masukkan nama barang" required>
                </div>
                <div class="form-group-inline">
                    <label for="itemType">Type</label>
                    <input type="text" id="itemType" placeholder="Masukkan type barang">
                </div>
                <div class="form-group-inline">
                    <label for="qtyLama">Qty Lama</label>
                    <input type="number" id="qtyLama" placeholder="Jumlah lama" min="0" value="0">
                </div>
                <div class="form-group-inline">
                    <label for="qtyBaru">Qty Baru</label>
                    <input type="number" id="qtyBaru" placeholder="Jumlah baru" min="0" value="0">
                </div>
                <div class="form-group-inline" style="grid-column:span 2">
                    <label>Status</label>
                    <div class="radio-group">
                        <label><input type="radio" name="status" value="Baik" checked> Baik</label>
                        <label><input type="radio" name="status" value="Rusak"> Rusak</label>
                        <label><input type="radio" name="status" value="Perlu Perbaikan"> Perlu Perbaikan</label>
                    </div>
                </div>
                <div class="form-group-inline" style="grid-column:span 2">
                    <label for="itemNote">Catatan</label>
                    <textarea id="itemNote" placeholder="Masukkan catatan (opsional)"></textarea>
                </div>
                <div class="form-group-inline" style="grid-column:span 2">
                    <label for="itemBarcode">Barcode</label>
                    <input type="text" id="itemBarcode" placeholder="Scan atau ketik barcode (otomatis jika kosong)">
                </div>
                <div class="form-group-inline" style="grid-column:span 2">
                    <label>QR Code Preview</label>
                    <div id="qrcodeContainer"></div>
                    <button type="button" class="btn-info" style="width:auto;margin-top:10px" onclick="generateQR()">üñ®Ô∏è Generate QR Code</button>
                </div>
            </div>
            <div class="action-buttons">
                <button onclick="saveItem()">üíæ Simpan</button>
                <button class="btn-secondary" onclick="showPage('inventoryPage')">‚¨ÖÔ∏è Kembali</button>
            </div>
        </div>
        
        <div id="scanPage" class="page">
            <h2>üì∑ Scan Barcode</h2>
            <div id="interactive" class="viewport"><video></video></div>
            <div id="scanStatus">Tekan tombol di bawah untuk mulai scan</div>
            <div class="scan-controls">
                <button id="startScan">‚ñ∂Ô∏è Mulai Scan</button>
                <button id="stopScan" style="display:none">‚èπÔ∏è Stop Scan</button>
            </div>
            <div class="manual-input-group">
                <h4>Atau Masukkan Barcode Manual:</h4>
                <input type="text" id="manualBarcode" placeholder="Ketik barcode di sini...">
                <button class="manual-search-btn" onclick="manualSearch()">üîç Cari</button>
            </div>
            <div id="scanResult" style="display:none">
                <h3>‚úÖ Hasil Pencarian:</h3>
                <div id="resultDetails"></div>
            </div>
            <div class="action-buttons">
                <button class="btn-secondary" onclick="showPage('inventoryPage')">‚¨ÖÔ∏è Kembali</button>
            </div>
        </div>
        
        <div id="reportPage" class="page">
            <h2>üìä Laporan Inventaris</h2>
            <div style="text-align:center;margin-bottom:30px">
                <h3>DAFTAR INVENTARIS SIE SEKOLAH MINGGU</h3>
                <p><strong>TAHUN 2026</strong></p>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>NO</th><th>NAMA</th><th>TYPE</th><th>LAMA</th><th>BARU</th><th>QTY</th><th>STATUS</th><th>CATATAN</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody"></tbody>
            </table>
            <div style="margin-top:40px;text-align:right">
                <p>Tangerang, 31 Desember 2025</p>
                <p><strong>St. Dameria Saragih</strong><br>Ketua SM</p>
                <p style="margin-top:40px"><strong>Sanny Girsang</strong><br>Sekretaris SM</p>
            </div>
            <div class="action-buttons">
                <button class="btn-info" onclick="downloadPDF()">üì• Download PDF</button>
                <button class="btn-secondary" onclick="showPage('dashboardPage')">‚¨ÖÔ∏è Kembali</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentUser=null,quaggaInitialized=false,currentBarcode='',inventoryData=JSON.parse(localStorage.getItem('inventoryData'))||[],csvDataPreview=[];
        
        function login(){const e=document.getElementById('username').value,t=document.getElementById('password').value;if(!e||!t){alert('‚ö†Ô∏è Username dan password harus diisi!');return}currentUser=e,document.getElementById('userName').textContent=e,updateDashboard(),showPage('dashboardPage')}
        
        function logout(){currentUser=null,showPage('loginPage'),document.getElementById('username').value='',document.getElementById('password').value=''}
        
        function showPage(e){document.querySelectorAll('.page').forEach(e=>{e.style.display='none'}),document.getElementById(e).style.display='block',e!=='scanPage'&&quaggaInitialized&&stopScanner(),e==='inventoryPage'?renderInventoryTable():e==='reportPage'&&renderReportTable()}
        
        function generateQR(){const e=document.getElementById('itemName').value.trim(),t=document.getElementById('itemType').value.trim(),a=document.getElementById('itemBarcode').value.trim();if(!e){alert('‚ö†Ô∏è Nama barang harus diisi terlebih dahulu!');return}let r=a;if(!r){const t=e.substring(0,2).toUpperCase();r=t+Date.now().toString().slice(-6)+Math.floor(100*Math.random()),document.getElementById('itemBarcode').value=r,alert('‚ÑπÔ∏è Barcode otomatis digenerate: '+r)}const n=JSON.stringify({id:window.editingItemId||Date.now(),nama:e,type:t||'-',barcode:r,timestamp:(new Date).toISOString()}),o=document.getElementById('qrcodeContainer');o.innerHTML='',new QRCode(o,{text:n,width:160,height:160,correctLevel:QRCode.CorrectLevel.H}),o.innerHTML+=`<p style="margin-top:10px;font-size:12px;color:#666">Barcode: ${r}</p>`,alert('‚úÖ QR Code berhasil digenerate!\n\nBarcode: '+r+'\n\nScan QR code ini untuk melihat detail barang.')}
        
        function showQRForItem(e){const t=document.getElementById('resultDetails'),a=document.createElement('div');a.id='scanQRContainer',a.style.marginTop='20px',a.style.textAlign='center',a.style.padding='15px',a.style.background='#f9f9f9',a.style.borderRadius='8px',a.style.border='2px solid #4CAF50';const r=JSON.stringify({id:e.id,nama:e.nama,type:e.type||'-',qty:e.qtyTotal,status:e.status,barcode:e.barcode,catatan:e.catatan||'-'});t.appendChild(a),new QRCode(a,{text:r,width:180,height:180,correctLevel:QRCode.CorrectLevel.H}),a.innerHTML+=`<p style="margin-top:10px;font-size:12px;color:#666">Scan untuk info lengkap</p>`}
        
        function printBarcodeLabel(e){const t=inventoryData.find(t=>t.id===e);if(!t)return;if(t.barcode==='N/A'||!t.barcode){const a=t.nama.substring(0,2).toUpperCase();t.barcode=a+Date.now().toString().slice(-6)+Math.floor(100*Math.random()),localStorage.setItem('inventoryData',JSON.stringify(inventoryData))}const a=window.open('','_blank');a.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>Label Barcode - ${t.nama}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body{font-family:Arial,sans-serif;text-align:center;padding:20px;margin:0;background:white}
        .label-container{width:300px;margin:0 auto;border:2px solid #000;padding:15px;page-break-after:always}
        .item-name{font-size:18px;font-weight:bold;margin:10px 0;color:#333}
        .item-detail{font-size:12px;margin:5px 0;color:#666}
        #qrcode{margin:15px auto;width:120px;height:120px}
        .barcode-text{font-family:'Courier New',monospace;font-size:10px;margin-top:5px;padding:3px;background:#f0f0f0;border-radius:3px}
        @media print{body{padding:0}.no-print{display:none}}
    </style>
</head>
<body onload="generate()">
    <div class="label-container">
        <div class="item-name">${t.nama}</div>
        <div class="item-detail">Type: ${t.type||'-'}</div>
        <div class="item-detail">Qty: ${t.qtyTotal}</div>
        <div class="item-detail">Status: ${t.status}</div>
        <div id="qrcode"></div>
        <div class="barcode-text">${t.barcode}</div>
    </div>
    <div class="no-print" style="margin-top:20px">
        <button onclick="window.print()" style="padding:10px 20px;background:#4CAF50;color:white;border:none;border-radius:5px;cursor:pointer">üñ®Ô∏è Print Label</button>
        <button onclick="window.close()" style="padding:10px 20px;background:#6c757d;color:white;border:none;border-radius:5px;cursor:pointer;margin-left:10px">‚úñÔ∏è Tutup</button>
    </div>
    <script>
        function generate(){const data=${JSON.stringify(JSON.stringify({id:t.id,nama:t.nama,type:t.type,qty:t.qtyTotal,status:t.status,barcode:t.barcode}))};new QRCode(document.getElementById("qrcode"),{text:data,width:120,height:120,correctLevel:QRCode.CorrectLevel.H})}
    </script>
</body>
</html>
        `),a.document.close()}
        
        function handleFileSelect(e){const t=e.target.files[0];if(!t)return;if(t.type!=='text/csv'&&!t.name.endsWith('.csv')){alert('‚ö†Ô∏è File harus berformat CSV!'),e.target.value='';return}const a=document.getElementById('fileInfo');a.innerHTML=`<strong>File terpilih:</strong> ${t.name}<br><strong>Ukuran:</strong> ${(t.size/1024).toFixed(2)} KB<br><strong>Type:</strong> ${t.type||'text/csv'}`,a.style.display='block',Papa.parse(t,{header:!1,skipEmptyLines:!0,complete:e=>{console.log('CSV parsed:',e),processCSVData(e.data)},error:e=>{alert('‚ùå Error membaca file CSV: '+e.message),console.error('CSV Parse Error:',e)}})}
        
        function processCSVData(e){const t=e.filter(e=>e.length>1&&e[0]&&e[0].trim()!==''&&!e[0].includes('DAFTAR')&&!e[0].includes('TAHUN')&&!e[0].includes('NO')&&!e[0].includes('Tangerang')&&!e[0].includes('Ketua')&&!e[0].includes('Sekretaris'));csvDataPreview=t.map(e=>({no:e[0]||'',nama:e[1]||'',type:e[2]||'',qtyLama:e[3]?parseInt(e[3])||0:0,qtyBaru:e[4]?parseInt(e[4])||0:0,qtyTotal:e[5]?parseInt(e[5])||0:0,status:e[6]||'Baik',catatan:e[7]||'',barcode:'N/A'})),showPreview()}
        
        function showPreview(){const e=document.getElementById('previewContainer'),t=document.getElementById('previewTableBody');t.innerHTML='';for(const a of csvDataPreview){const r=document.createElement('tr');r.innerHTML=`<td>${a.no}</td><td>${a.nama}</td><td>${a.type}</td><td>${a.qtyLama}</td><td>${a.qtyBaru}</td><td>${a.qtyTotal}</td><td>${a.status}</td><td>${a.catatan}</td>`,t.appendChild(r)}const a=document.getElementById('importSummary');a.innerHTML=`<strong>üìä Ringkasan Import:</strong><br>Total baris: ${csvDataPreview.length}<br>Barang dengan status Baik: ${csvDataPreview.filter(e=>e.status==='Baik').length}<br>Barang Rusak: ${csvDataPreview.filter(e=>e.status==='Rusak').length}<br>Barang Perlu Perbaikan: ${csvDataPreview.filter(e=>e.status==='Perlu Perbaikan').length}`,a.style.display='block',e.style.display='block'}
        
        function importData(){if(0===csvDataPreview.length){alert('‚ö†Ô∏è Tidak ada data untuk diimport!');return}if(confirm(`‚ùì Apakah Anda yakin ingin mengimport ${csvDataPreview.length} data barang?\n\nData lama akan ditambahkan dengan data baru.`)){const e=csvDataPreview.map(e=>{let t='N/A';return e.nama&&e.nama.trim()!==''&&(t=e.nama.substring(0,2).toUpperCase().replace(/[^A-Z0-9]/g,'')+Date.now().toString().slice(-4)+Math.floor(1e3*Math.random())),{id:Date.now()+Math.floor(1e6*Math.random()),nama:e.nama,type:e.type,qtyLama:e.qtyLama,qtyBaru:e.qtyBaru,qtyTotal:e.qtyTotal||(e.qtyLama+e.qtyBaru),status:e.status,catatan:e.catatan,barcode:t}}),t=confirm('‚ùì Apakah Anda ingin menggabungkan dengan data yang sudah ada?\n\nTekan Cancel untuk mengganti semua data.');t?inventoryData=[...inventoryData,...e]:inventoryData=e,localStorage.setItem('inventoryData',JSON.stringify(inventoryData)),updateDashboard(),cancelImport(),renderInventoryTable(),alert(`‚úÖ Berhasil mengimport ${e.length} data barang!\n\nSemua barang sudah memiliki barcode otomatis.`)}}
        
        function cancelImport(){document.getElementById('fileInput').value='',document.getElementById('inventoryFileInput').value='',document.getElementById('fileInfo').style.display='none',document.getElementById('previewContainer').style.display='none',document.getElementById('previewTableBody').innerHTML='',document.getElementById('importSummary').style.display='none',csvDataPreview=[]}
        
        function saveItem(){const e=document.getElementById('itemName').value.trim(),t=document.getElementById('itemType').value.trim(),a=parseInt(document.getElementById('qtyLama').value)||0,r=parseInt(document.getElementById('qtyBaru').value)||0,n=document.querySelector('input[name="status"]:checked').value,o=document.getElementById('itemNote').value.trim(),i=document.getElementById('itemBarcode').value.trim();if(!e){alert('‚ö†Ô∏è Nama barang harus diisi!');return}let s=i;s||(s=e.substring(0,2).toUpperCase().replace(/[^A-Z0-9]/g,'')+Date.now().toString().slice(-6)+Math.floor(100*Math.random()));const l={id:window.editingItemId||Date.now(),nama:e,type:t,qtyLama:a,qtyBaru:r,qtyTotal:a+r,status:n,catatan:o,barcode:s};window.editingItemId?(inventoryData[inventoryData.findIndex(e=>e.id===window.editingItemId)]=l):(inventoryData.push(l),localStorage.setItem('inventoryData',JSON.stringify(inventoryData)),document.getElementById('itemName').value='',document.getElementById('itemType').value='',document.getElementById('qtyLama').value='0',document.getElementById('qtyBaru').value='0',document.querySelector('input[name="status"][value="Baik"]').checked=!0,document.getElementById('itemNote').value='',document.getElementById('itemBarcode').value='',document.getElementById('qrcodeContainer').innerHTML='',delete window.editingItemId,updateDashboard(),alert('‚úÖ Barang berhasil ditambahkan!\n\nBarcode: '+s),showPage('inventoryPage'))}
        
        function renderInventoryTable(){const e=document.getElementById('inventoryTableBody');if(e.innerHTML='',0===inventoryData.length){e.innerHTML=`<tr><td colspan="10" style="text-align:center;padding:40px">Belum ada data inventaris. <br><button class="menu-btn" onclick="showPage('addPage')" style="margin-top:10px;width:auto;padding:8px 16px">‚ûï Tambah Barang Pertama</button><br><br><button class="menu-btn" onclick="document.getElementById('inventoryFileInput').click()" style="margin-top:10px;width:auto;padding:8px 16px;background:#ffc107;color:#333">üì§ Upload Data CSV</button></td></tr>`;return}inventoryData.forEach((t,a)=>{let r='#4CAF50';'Rusak'===t.status?r='#f44336':'Perlu Perbaikan'===t.status&&(r='#ff9800'),(!t.barcode||'N/A'===t.barcode)&&(t.barcode=t.nama.substring(0,2).toUpperCase().replace(/[^A-Z0-9]/g,'')+Date.now().toString().slice(-4)+Math.floor(1e3*Math.random()),localStorage.setItem('inventoryData',JSON.stringify(inventoryData))),e.innerHTML+=`<tr><td>${a+1}</td><td>${t.nama}</td><td>${t.type||'-'}</td><td>${t.qtyLama}</td><td>${t.qtyBaru}</td><td>${t.qtyTotal}</td><td><span style="color:${r};font-weight:bold">${t.status}</span></td><td>${t.barcode}</td><td><button class="btn-info" style="width:auto;padding:5px 10px;font-size:12px" onclick="editItem(${t.id})">‚úèÔ∏è</button> <button class="btn-danger" style="width:auto;padding:5px 10px;font-size:12px" onclick="deleteItem(${t.id})">üóëÔ∏è</button> <button class="btn-warning" style="width:auto;padding:5px 10px;font-size:12px" onclick="printBarcodeLabel(${t.id})">üñ®Ô∏è</button></td></tr>`})}
        
        function deleteItem(e){confirm('‚ùì Apakah Anda yakin ingin menghapus barang ini?')&&(inventoryData=inventoryData.filter(t=>t.id!==e),localStorage.setItem('inventoryData',JSON.stringify(inventoryData)),updateDashboard(),renderInventoryTable(),alert('‚úÖ Barang berhasil dihapus!'))}
        
        function editItem(e){const t=inventoryData.find(t=>t.id===e);if(!t)return;document.getElementById('itemName').value=t.nama,document.getElementById('itemType').value=t.type||'',document.getElementById('qtyLama').value=t.qtyLama,document.getElementById('qtyBaru').value=t.qtyBaru,document.querySelector(`input[name="status"][value="${t.status}"]`).checked=!0,document.getElementById('itemNote').value=t.catatan||'',document.getElementById('itemBarcode').value=t.barcode,setTimeout(()=>{t.barcode&&'N/A'!==t.barcode&&generateQR()},100),window.editingItemId=e,showPage('addPage'),document.querySelector('#addPage button[onclick="saveItem()"]').textContent='‚úèÔ∏è Update'}
        
        function updateDashboard(){const e=inventoryData.length,t=inventoryData.filter(e=>e.status==='Baik').length,a=inventoryData.filter(e=>e.status==='Rusak').length,r=inventoryData.filter(e=>e.status==='Perlu Perbaikan').length;document.getElementById('totalItems').textContent=e,document.getElementById('goodItems').textContent=t,document.getElementById('brokenItems').textContent=a,document.getElementById('repairItems').textContent=r}
        
        document.addEventListener('DOMContentLoaded',()=>{document.getElementById('startScan').addEventListener('click',startScanner),document.getElementById('stopScan').addEventListener('click',stopScanner)}),function startScanner(){navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{e.getTracks().forEach(e=>e.stop()),initQuaggaScanner()}).catch(e=>{alert('‚ùå Gagal mengakses kamera!\n\n'+e.message+'\n\nPastikan:\n1. Menggunakan HTTPS (Vercel sudah OK ‚úÖ)\n2. Memberikan izin kamera\n3. Menggunakan browser yang support (Chrome, Firefox, Edge)'),console.error('Camera error:',e)})},function initQuaggaScanner(){document.getElementById('startScan').style.display='none',document.getElementById('stopScan').style.display='inline-block',document.getElementById('scanStatus').innerHTML='üîç Memindai... Arahkan kamera ke barcode',document.getElementById('scanStatus').style.background='#fff3cd',quaggaInitialized?(Quagga.start(),void 0):(Quagga.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector('#interactive'),constraints:{width:{min:640},height:{min:480},facingMode:"environment",aspectRatio:{min:1,max:2}}},decoder:{readers:["code_128_reader","ean_reader","ean_8_reader","code_39_reader","upc_reader","code_93_reader"]},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:2,frequency:10},e=>{if(e)return void console.error('Quagga init error:',e);console.log("Quagga initialized successfully"),quaggaInitialized=!0,Quagga.start(),setTimeout(()=>{quaggaInitialized&&!currentBarcode&&(document.getElementById('scanStatus').innerHTML='‚ö†Ô∏è Tidak ada barcode terdeteksi dalam 30 detik. Coba lagi!',document.getElementById('scanStatus').style.background='#fff3cd')},3e4)}),void Quagga.onDetected(e=>{const t=e.codeResult.code;console.log('Barcode detected:',t),stopScanner(),currentBarcode=t,document.getElementById('scanStatus').innerHTML='‚úÖ Barcode terdeteksi: <strong>'+t+'</strong>',document.getElementById('scanStatus').style.background='#e8f5e9',processBarcode(t)}))},function stopScanner(){quaggaInitialized&&Quagga.stop(),document.getElementById('startScan').style.display='inline-block',document.getElementById('stopScan').style.display='none',document.getElementById('scanStatus').innerHTML='‚èπÔ∏è Scan dihentikan',document.getElementById('scanStatus').style.background='#f0f0f0',quaggaInitialized=!1,currentBarcode=''},function processBarcode(e){const t=inventoryData.find(t=>t.barcode===e),a=document.getElementById('resultDetails'),r=document.getElementById('scanResult');a.innerHTML='';const n=document.getElementById('scanQRContainer');n&&n.remove(),t?(a.innerHTML=`<p><strong>Nama:</strong> ${t.nama}</p><p><strong>Type:</strong> ${t.type||'-'}</p><p><strong>Qty Lama:</strong> ${t.qtyLama}</p><p><strong>Qty Baru:</strong> ${t.qtyBaru}</p><p><strong>Qty Total:</strong> ${t.qtyTotal}</p><p><strong>Status:</strong> <span style="color:${'#4CAF50'===t.status?'#4CAF50':t.status==='Rusak'?'#f44336':'#ff9800'};font-weight:bold">${t.status}</span></p><p><strong>Catatan:</strong> ${t.catatan||'-'}</p><p><strong>Barcode:</strong> ${t.barcode}</p><div style="margin-top:15px"><button class="btn-info" style="width:auto;padding:8px 16px" onclick="editItem(${t.id})">‚úèÔ∏è Edit</button> <button class="btn-danger" style="width:auto;padding:8px 16px;margin-left:10px" onclick="deleteItem(${t.id})">üóëÔ∏è Hapus</button> <button class="btn-warning" style="width:auto;padding:8px 16px;margin-left:10px" onclick="printBarcodeLabel(${t.id})">üñ®Ô∏è Print Label</button></div>`,showQRForItem(t),r.style.display='block'):a.innerHTML=`<p>‚ùå Barang dengan barcode <strong>${e}</strong> tidak ditemukan dalam inventory.</p><button class="btn-success" style="width:auto;padding:8px 16px;margin-top:10px" onclick="addItemFromScan('${e}')">‚ûï Tambah Barang Baru</button>`,r.style.display='block'},function manualSearch(){const e=document.getElementById('manualBarcode').value.trim();e?(document.getElementById('scanStatus').innerHTML='üîç Mencari: <strong>'+e+'</strong>',document.getElementById('scanStatus').style.background='#e3f2fd',currentBarcode=e,processBarcode(e)):alert('‚ö†Ô∏è Silakan masukkan barcode terlebih dahulu!')},function addItemFromScan(e){showPage('addPage'),document.getElementById('itemBarcode').value=e,document.getElementById('itemName').focus(),setTimeout(()=>{alert('‚ÑπÔ∏è Barcode sudah diisi otomatis. Silakan lengkapi data barang lainnya.')},100)},function renderReportTable(){const e=document.getElementById('reportTableBody');if(e.innerHTML='',0===inventoryData.length){e.innerHTML=`<tr><td colspan="8" style="text-align:center;padding:40px">Belum ada data inventaris.</td></tr>`;return}inventoryData.forEach((t,a)=>{e.innerHTML+=`<tr><td>${a+1}</td><td>${t.nama}</td><td>${t.type||'-'}</td><td>${t.qtyLama}</td><td>${t.qtyBaru}</td><td>${t.qtyTotal}</td><td>${t.status}</td><td>${t.catatan||'-'}</td></tr>`})},function downloadPDF(){alert('‚ÑπÔ∏è Fitur download PDF akan menggunakan library seperti jsPDF.\n\nUntuk sekarang, Anda bisa print halaman ini (Ctrl+P) dan save sebagai PDF.')},window.onload=function(){inventoryData=JSON.parse(localStorage.getItem('inventoryData'))||[];let e=!1;inventoryData.forEach(t=>{(!t.barcode||'N/A'===t.barcode)&&(t.barcode=t.nama.substring(0,2).toUpperCase().replace(/[^A-Z0-9]/g,'')+Date.now().toString().slice(-4)+Math.floor(1e3*Math.random()),e=!0)}),e&&localStorage.setItem('inventoryData',JSON.stringify(inventoryData)),updateDashboard(),console.log('‚úÖ Aplikasi Inventory Sekolah Minggu siap!'),console.log('‚úÖ QR Code Generator aktif!'),console.log('‚úÖ Auto-generate barcode untuk semua barang')};
    </script>
</body>
</html>
